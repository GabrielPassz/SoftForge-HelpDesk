using Microsoft.AspNetCore.Mvc;
using Microsoft.AspNetCore.Mvc.RazorPages;
using PIM.Data;
using PIM.Models;

namespace PIM.Pages.DbTestes
{
 public class AbrirChamadoModel : PageModel
 {
 private readonly PIMContext _context;
 public AbrirChamadoModel(PIMContext context) => _context = context;

 [BindProperty]
 public string Titulo { get; set; }
 [BindProperty]
 public string Descricao { get; set; }
 public bool Created { get; set; }
 public string CreatedProtocol { get; set; }
 public void OnGet() { }
 public async Task<IActionResult> OnPostAsync()
 {
 var chamado = new Chamado
 {
 Protocolo = "TEST-" + Guid.NewGuid().ToString().Substring(0,8),
 Titulo = Titulo,
 Descricao = Descricao,
 DataAbertura = DateTime.Now,
 UsuarioSolicitanteId = _context.Usuarios.Select(u => u.UsuarioId).FirstOrDefault()
 };
 _context.Chamados.Add(chamado);
 await _context.SaveChangesAsync();
 Created = true;
 CreatedProtocol = chamado.Protocolo;
 return Page();
 }
 }
}