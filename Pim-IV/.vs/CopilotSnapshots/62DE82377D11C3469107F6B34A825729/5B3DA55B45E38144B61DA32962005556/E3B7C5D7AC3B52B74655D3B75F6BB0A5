// Opt-in list/table limiter + global stacked labels (refined for card rows)
(function(){
 const DEFAULT_LIMIT =3;
 function getLimit(el){ const v = parseInt(el.getAttribute('data-limit') || '',10); return Number.isFinite(v) && v >0 ? v : DEFAULT_LIMIT; }
 function makeButton(){ const b=document.createElement('button'); b.type='button'; b.className='btn btn-sm btn-secondary limit-toggle'; b.textContent='Mostrar mais'; return b; }
 function applyToList(list){ const LIMIT=getLimit(list); const items=[...list.children]; if(items.length<=LIMIT) return; const hidden=items.slice(LIMIT); hidden.forEach(li=>li.style.display='none'); const btn=makeButton(); btn.addEventListener('click',()=>{ const expanded=hidden[0].style.display!=='none'; hidden.forEach(li=>li.style.display=expanded?'none':'list-item'); btn.textContent=expanded?'Mostrar mais':'Mostrar menos';}); list.insertAdjacentElement('afterend', Object.assign(document.createElement('div'),{className:'limit-wrap'}).appendChild(btn).parentNode); }
 function applyToTable(table){ const LIMIT=getLimit(table); const tb=table.querySelector('tbody')||table; const rows=[...tb.querySelectorAll('tr')]; if(rows.length<=LIMIT) return; const hidden=rows.slice(LIMIT); hidden.forEach(r=>r.style.display='none'); const btn=makeButton(); btn.addEventListener('click',()=>{ const expanded=hidden[0].style.display!=='none'; hidden.forEach(r=>r.style.display=expanded?'none':'table-row'); btn.textContent=expanded?'Mostrar mais':'Mostrar menos';}); table.insertAdjacentElement('afterend', Object.assign(document.createElement('div'),{className:'limit-wrap',style:'margin-top:4px'}).appendChild(btn).parentNode); }
 function enhanceTableLabels(root){ (root||document).querySelectorAll('table:not(.no-stack)').forEach(t=>{ const headers=[...t.querySelectorAll('thead th')].map(th=>th.textContent.trim()); if(!headers.length){ t.classList.add('no-stack'); return; } t.querySelectorAll('tbody tr').forEach(tr=>{ [...tr.cells].forEach((td,i)=>{ if(!td.hasAttribute('data-label')) td.setAttribute('data-label', headers[i]||''); }); }); }); }
 document.addEventListener('DOMContentLoaded',()=>{ document.querySelectorAll('table.limit-rows, table[data-limit]').forEach(applyToTable); document.querySelectorAll('ul.limit-rows, ol.limit-rows, ul[data-limit], ol[data-limit]').forEach(applyToList); enhanceTableLabels(document); });
})();