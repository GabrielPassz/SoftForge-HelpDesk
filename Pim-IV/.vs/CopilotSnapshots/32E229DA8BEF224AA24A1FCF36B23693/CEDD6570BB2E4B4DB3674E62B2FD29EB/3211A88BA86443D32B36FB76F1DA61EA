@model PIM_FINAL.Models.RelatoriosViewModel
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
<!DOCTYPE html>
<html lang="pt-BR">
<head>
 <meta charset="utf-8" /> @* Codificação *@
 <meta name="viewport" content="width=device-width, initial-scale=1.0" /> @* Responsivo *@
 <title>Relatórios - SoftForge HelpDesk</title> @* Título *@
 <link rel="stylesheet" href="/css/dbtestes.css" /> @* Estilos *@
</head>
<body>
<div class="db-page container-fluid"> @* Container principal *@
 @await Html.PartialAsync("_HeaderNav") @* Navegação *@

 <main class="db-content"> @* Conteúdo *@
 <section class="db-section db-intro"> @* Cabeçalho e período *@
 <h2>Relatórios e KPIs</h2>
 <p><strong>Gestor/Administrador:</strong> @User?.Identity?.Name</p>
 <p><strong>Período:</strong> @Model?.PeriodoInicio.ToLocalTime().ToString("dd/MM/yyyy") a @Model?.PeriodoFim.ToLocalTime().ToString("dd/MM/yyyy")</p>
 </section>

 <section class="db-section"> @* Filtros de período *@
 <h3>Filtros Rápidos</h3>
 <form method="get" asp-action="Relatorios" asp-controller="Site" class="form-inline">
 <select name="periodo" class="form-select">
 <option value="hoje">Hoje</option>
 <option value="semana">Esta Semana</option>
 <option value="mes">Este Mês</option>
 </select>
 <button type="submit" class="btn btn-primary">Atualizar</button>
 </form>
 </section>

 <section id="rel_geral" class="db-section"> @* Resumo executivo *@
 <h3>Resumo Executivo</h3>
 <table class="table table-bordered w-100 stack-mobile">
 <thead>
 <tr><th>Indicador</th><th>Valor</th></tr>
 </thead>
 <tbody>
 <tr><td data-label="Indicador">Tempo Médio de Resolução</td><td data-label="Valor"><span class="cell-val">@Model?.TempoMedioResolucao</span></td></tr>
 <tr><td data-label="Indicador">Satisfação Média</td><td data-label="Valor"><span class="cell-val">@Model?.SatisfacaoMedia (@Model?.TotalAvaliacoes avaliações)</span></td></tr>
 <tr><td data-label="Indicador">Total no Período</td><td data-label="Valor"><span class="cell-val">@Model?.TotalChamadosPeriodo</span></td></tr>
 <tr><td data-label="Indicador">Resolvidos</td><td data-label="Valor"><span class="cell-val">@Model?.TotalResolvidosPeriodo</span></td></tr>
 <tr><td data-label="Indicador">Taxa de Resolução</td><td data-label="Valor"><span class="cell-val">@Model?.TaxaResolucaoPercent%</span></td></tr>
 </tbody>
 </table>
 </section>

 <section class="db-section"> @* Distribuições por status *@
 <h3>Chamados por Status</h3>
 <table class="table table-bordered w-100 stack-mobile limit-rows" data-limit="3">
 <thead>
 <tr><th>Status</th><th>Qtd</th><th>%</th></tr>
 </thead>
 <tbody>
 @foreach (var it in Model?.Status ?? new List<PIM_FINAL.Models.ItemResumo>())
 {<tr><td data-label="Status"><span class="cell-val">@it.Nome</span></td><td data-label="Qtd"><span class="cell-val">@it.Quantidade</span></td><td data-label="%"><span class="cell-val">@it.Percentual%</span></td></tr>}
 </tbody>
 </table>
 </section>

 <section class="db-section"> @* Distribuições por prioridade *@
 <h3>Chamados por Prioridade</h3>
 <table class="table table-bordered w-100 stack-mobile limit-rows" data-limit="3">
 <thead>
 <tr><th>Prioridade</th><th>Qtd</th><th>%</th></tr>
 </thead>
 <tbody>
 @foreach (var it in Model?.Prioridades ?? new List<PIM_FINAL.Models.ItemResumo>())
 {<tr><td data-label="Prioridade"><span class="cell-val">@it.Nome</span></td><td data-label="Qtd"><span class="cell-val">@it.Quantidade</span></td><td data-label="%"><span class="cell-val">@it.Percentual%</span></td></tr>}
 </tbody>
 </table>
 </section>

 <section class="db-section"> @* Distribuições por categoria *@
 <h3>Chamados por Categoria</h3>
 <table class="table table-bordered w-100 stack-mobile limit-rows" data-limit="3">
 <thead>
 <tr><th>Categoria</th><th>Qtd</th><th>%</th></tr>
 </thead>
 <tbody>
 @foreach (var it in Model?.Categorias ?? new List<PIM_FINAL.Models.ItemResumo>())
 {<tr><td data-label="Categoria"><span class="cell-val">@it.Nome</span></td><td data-label="Qtd"><span class="cell-val">@it.Quantidade</span></td><td data-label="%"><span class="cell-val">@it.Percentual%</span></td></tr>}
 </tbody>
 </table>
 </section>

 <section class="db-section"> @* Distribuições por departamento *@
 <h3>Chamados por Departamento</h3>
 <table class="table table-bordered w-100 stack-mobile limit-rows" data-limit="3">
 <thead>
 <tr><th>Departamento</th><th>Qtd</th><th>%</th></tr>
 </thead>
 <tbody>
 @foreach (var it in Model?.Departamentos ?? new List<PIM_FINAL.Models.ItemResumo>())
 {<tr><td data-label="Departamento"><span class="cell-val">@it.Nome</span></td><td data-label="Qtd"><span class="cell-val">@it.Quantidade</span></td><td data-label="%"><span class="cell-val">@it.Percentual%</span></td></tr>}
 </tbody>
 </table>
 </section>

 <section class="db-section"> @* Ranking de técnicos *@
 <h3>Desempenho por Técnico</h3>
 <table class="table table-bordered w-100 stack-mobile limit-rows" data-limit="3">
 <thead>
 <tr><th>Técnico</th><th>Atendidos</th><th>Resolvidos</th><th>Taxa</th><th>Tempo Médio</th><th>Avaliação</th></tr>
 </thead>
 <tbody>
 @foreach (var t in Model?.Tecnicos ?? new List<PIM_FINAL.Models.TecnicoResumo>())
 {<tr><td data-label="Técnico"><span class="cell-val">@t.Nome</span></td><td data-label="Atendidos"><span class="cell-val">@t.Atendidos</span></td><td data-label="Resolvidos"><span class="cell-val">@t.Resolvidos</span></td><td data-label="Taxa"><span class="cell-val">@t.TaxaResolucao%</span></td><td data-label="Tempo Médio"><span class="cell-val">@t.TempoMedio</span></td><td data-label="Avaliação"><span class="cell-val">@t.AvaliacaoMedia</span></td></tr>}
 </tbody>
 </table>
 </section>

 <section class="db-section"> @* SLA por prioridade *@
 <h3>SLA por Prioridade</h3>
 <table class="table table-bordered w-100 stack-mobile limit-rows" data-limit="3">
 <thead>
 <tr><th>Prioridade</th><th>Total</th><th>Cumpridos</th><th>Violados</th><th>Taxa</th></tr>
 </thead>
 <tbody>
 @foreach (var s in Model?.SlaPorPrioridade ?? new List<PIM_FINAL.Models.SlaResumo>())
 {<tr><td data-label="Prioridade"><span class="cell-val">@s.Prioridade</td><td data-label="Total"><span class="cell-val">@s.Total</span></td><td data-label="Cumpridos"><span class="cell-val">@s.Cumpridos</span></td><td data-label="Violados"><span class="cell-val">@s.Violados</span></td><td data-label="Taxa"><span class="cell-val">@s.TaxaCumprimento%</span></td></tr>}
 </tbody>
 </table>
 </section>

 <section class="db-section"> @* Distribuição de satisfação *@
 <h3>Distribuição de Satisfação</h3>
 <table class="table table-bordered w-100 stack-mobile limit-rows" data-limit="3">
 <thead>
 <tr><th>Avaliação</th><th>Qtd</th><th>%</th></tr>
 </thead>
 <tbody>
 @foreach (var it in Model?.DistribuicaoNotas ?? new List<PIM_FINAL.Models.ItemResumo>())
 {<tr><td data-label="Avaliação"><span class="cell-val">@it.Nome</span></td><td data-label="Qtd"><span class="cell-val">@it.Quantidade</span></td><td data-label="%"><span class="cell-val">@it.Percentual%</span></td></tr>}
 </tbody>
 </table>
 </section>

 <section class="db-section"> @* Exportação da visão *@
 <h3>Exportar Relatórios</h3>
 <form method="post" asp-action="Relatorios" asp-controller="Site" asp-route-handler="ExportarCompleto">
 <p>Exportar todos os relatórios acima em um único arquivo:</p>
 <label for="formato_completo">Formato:</label>
 <select id="formato_completo" name="formato">
 <option value="csv" selected>CSV</option>
 <option value="excel">Excel</option>
 <option value="zip">ZIP (Múltiplos Arquivos)</option>
 </select>
 <button type="submit" class="btn btn-primary">Exportar Tudo</button>
 </form>
 </section>

 </main>

 <div class="db-footer"> @* Rodapé *@
 <footer>
 <p>©2025 SoftForge - Todos os direitos reservados</p>
 </footer>
 </div>
 </div>
</body>
</html>