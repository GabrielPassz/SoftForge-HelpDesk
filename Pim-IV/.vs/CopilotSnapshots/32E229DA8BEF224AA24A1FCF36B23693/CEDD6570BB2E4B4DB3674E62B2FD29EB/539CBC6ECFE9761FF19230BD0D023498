@model PIM_FINAL.Models.DashboardGestorViewModel
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
<!DOCTYPE html>
<html lang="pt-BR">
 <head>
 <meta charset="utf-8" /> @* Codificação *@
 <meta name="viewport" content="width=device-width, initial-scale=1.0" /> @* Responsivo *@
 <title>Dashboard - SoftForge HelpDesk</title> @* Título *@
 <link rel="stylesheet" href="/css/dbtestes.css" /> @* Estilos *@
 </head>
 <body>
 <div class="db-page container-fluid db-atendimento"> @* Container principal *@
 @await Html.PartialAsync("_HeaderNav") @* Navegação *@

 <main class="db-content"> @* Conteúdo *@
 <div class="container-fluid"> @* Cabeçalho do dashboard *@
 <h2>Dashboard Gerencial</h2>
 <p><strong>Gestor:</strong> @User?.Identity?.Name</p>
 <p><strong>Período:</strong> Hoje (@DateTime.UtcNow.ToLocalTime().ToString("dd/MM/yyyy"))</p>
 </div>

<section class="db-section db-overview"> @* Filtros simples de período *@
 <h3>Filtros</h3>
 <form method="get" asp-action="DashboardGestor" asp-controller="Site">
 <label for="periodo">Período:</label>
 <select id="periodo" name="periodo">
 <option value="hoje" selected>Hoje</option>
 <option value="semana">Esta Semana</option>
 <option value="mes">Este Mês</option>
 </select>
 <button type="submit">Atualizar</button>
 </form>
 </section>

 <section> @* Tabela de KPIs de alto nível *@
 <h3>Indicadores Principais (KPIs)</h3>
 <table class="table table-bordered w-100 stack-mobile kv-table">
 <thead>
 <tr>
 <th>KPI</th>
 <th>Valor Atual</th>
 </tr>
 </thead>
 <tbody>
 <tr>
 <td data-label="KPI">Total de Chamados</td>
 <td data-label="Total de Chamados:"><span class="cell-val">@Model?.TotalChamados</span></td>
 </tr>
 <tr>
 <td data-label="KPI">Chamados Resolvidos</td>
 <td data-label="Valor Atual"><span class="cell-val">@Model?.ChamadosResolvidos</span></td>
 </tr>
 <tr>
 <td data-label="KPI">Taxa de Resolução</td>
 <td data-label="Taxa de Resolução"><span class="cell-val">@Model?.TaxaResolucaoPercent@("%")</span></td>
 </tr>
 <tr>
 <td data-label="KPI">SLA Cumprido</td>
 <td data-label="SLA Cumprido"><span class="cell-val">@Model?.SLACumpridoPercent@("%")</span></td>
 </tr>
 <tr>
 <td data-label="KPI">Tempo Médio de Resolução</td>
 <td data-label="Tempo Médio de Resolução"><span class="cell-val">@Model?.TempoMedioResolucao</span></td>
 </tr>
 <tr>
 <td data-label="KPI">Satisfação do Usuário</td>
 <td data-label="Satisfação do Usuário"><span class="cell-val">@Model?.SatisfacaoMedia/5 (@Model?.TotalAvaliacoes avaliações)</span></td>
 </tr>
 <tr>
 <td data-label="KPI">Chamados em Espera</td>
 <td data-label="Chamados em Espera"><span class="cell-val">@(Model?.TotalChamados - Model?.ChamadosResolvidos)</span></td>
 </tr>
 <tr>
 <td data-label="KPI">Chamados Críticos Abertos</td>
 <td data-label="Chamados Críticos Abertos"><span class="cell-val">-</span></td>
 </tr>
 </tbody>
 </table>
 </section>

 <section> @* Desempenho por técnico (tabela) *@
 <h3>Desempenho da Equipe</h3>
 <table class="table table-bordered w-100 stack-mobile limit-rows" data-limit="3">
 <thead>
 <tr>
 <th>Técnico</th>
 <th>Atendidos</th>
 <th>Resolvidos</th>
 <th>Taxa Resolução</th>
 <th>Tempo Médio</th>
 <th>Avaliação</th>
 </tr>
 </thead>
 <tbody>
 @foreach (var t in Model?.DesempenhoEquipe ?? new List<(string Tecnico, int Atendidos, int Resolvidos, double Taxa, string TempoMedio, double Avaliacao)>())
 {
 <tr>
 <td data-label="Técnico"><span class="cell-val">@t.Tecnico</span></td>
 <td data-label="Atendidos"><span class="cell-val">@t.Atendidos</span></td>
 <td data-label="Resolvidos"><span class="cell-val">@t.Resolvidos</span></td>
 <td data-label="Taxa Resolução"><span class="cell-val">@t.Taxa@("%")</span></td>
 <td data-label="Tempo Médio"><span class="cell-val">@t.TempoMedio</span></td>
 <td data-label="Avaliação"><span class="cell-val">@t.Avaliacao</span></td>
 </tr>
 }
 </tbody>
 </table>
 </section>

 <section> @* Botão de exportação simples *@
 <h3>Exportar Dashboard</h3>
 <form method="post" action="/exportar-dashboard">
 <label for="formato_export">Formato:</label>
 <select id="formato_export" name="formato">
 <option value="csv" selected>CSV</option>
 </select>
 <button type="submit">Exportar</button>
 </form>
 </section>
 </main>
 <div class="db-footer"> @* Rodapé *@
 <footer>
 <p>&copy;2025 SoftForge - Todos os direitos reservados</p>
 </footer>
 </div>
 </div>
 </body>
</html>
