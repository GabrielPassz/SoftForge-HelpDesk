@model List<PIM_FINAL.Models.ChamadoSummary>
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" /> @* Codificação *@
<meta name="viewport" content="width=device-width, initial-scale=1.0" /> @* Responsivo *@
<title>Escalonamento - SoftForge HelpDesk</title> @* Título *@
<link rel="stylesheet" href="/css/dbtestes.css" /> @* Estilos *@
</head>
<body>
<div class="db-page container-fluid"> @* Container principal *@
 @await Html.PartialAsync("_HeaderNav") @* Navegação *@

 <main class="db-content"> @* Conteúdo *@
 <div class="db-header"> @* Cabeçalho *@
 <header>
 <h1>Escalonamento</h1>
 <p>Área de monitoramento e escalonamento de chamados</p>
 </header>
 </div>

 <section class="db-section"> @* Informações de contexto *@
 <h2>Escalonamento de Chamados</h2>
 <p><strong>Coordenador:</strong> @User?.Identity?.Name</p>
 </section>

 <section class="db-section"> @* Filtros frontend *@
 <h3>Filtros e Pesquisa</h3>
 <form method="get" asp-action="Escalonamento" asp-controller="Site"> @* Filtro por urgência e protocolo *@
 <label for="filtro_urgencia">Urgência:</label>
 <select id="filtro_urgencia" name="urgencia">
 <option value="">Todas</option>
 <option value="critico">Críticos sem resposta</option>
 <option value="sla_75">SLA &gt;75%</option>
 <option value="sla_50">SLA50-75%</option>
 </select>

 <label for="busca_protocolo">Buscar por protocolo:</label>
 <input type="text" id="busca_protocolo" name="protocolo" placeholder="Ex: CHAM-2025-001" />

 <button type="submit" class="btn btn-primary">Filtrar</button>
 </form>
 </section>

 @* <section class="db-section">
 <h3>Chamados em Risco (>=50% SLA consumido)</h3>
 <p>Lista de chamados que já consumiram metade ou mais do tempo de SLA.</p>

 <table class="table table-bordered w-100 stack-mobile limit-rows" data-limit="3">
 <thead>
 <tr>
 <th>Protocolo</th>
 <th>Título</th>
 <th>Prioridade</th>
 <th>Técnico</th>
 <th>SLA Consumido</th>
 <th>Tempo Restante</th>
 <th>Ações</th>
 </tr>
 </thead>
 <tbody>
 @if (Model == null || !Model.Any())
 {
 <tr><td colspan="7">Nenhum chamado em risco encontrado.</td></tr>
 }
 else
 {
 foreach (var c in Model)
 {
 <tr>
 <td data-label="Protocolo"><span class="cell-val"><strong>@c.Protocolo</strong></span></td>
 <td data-label="Título"><span class="cell-val">@c.Titulo</span></td>
 <td data-label="Prioridade"><span class="cell-val">@c.Prioridade</span></td>
 <td data-label="Técnico"><span class="cell-val">@c.Tecnico</span></td>
 <td data-label="SLA Consumido"><span class="cell-val">@c.SlaConsumedPercent%</span></td>
 <td data-label="Tempo Restante"><span class="cell-val">@(c.TimeRemaining.HasValue ? (c.TimeRemaining.Value.TotalHours >=1 ? string.Format("{0:%h}h{0:%m}m", c.TimeRemaining) : string.Format("{0:%m}m", c.TimeRemaining)) : "-")</span></td>
 <td data-label="Ações"><span class="cell-val"><a asp-controller="Site" asp-action="DetalhesChamado" asp-route-id="@c.ChamadoId">Ver Detalhes</a> |
 <form method="post" asp-action="Escalonamento" asp-controller="Site" style="display:inline">
 <input type="hidden" name="protocolo" value="@c.Protocolo" />
 <input type="hidden" name="motivo" value="Escalonamento automático: SLA consumido @c.SlaConsumedPercent%" />
 <button type="submit" class="btn btn-primary btn-sm">Escalonar</button>
 </form></span>
 </td>
 </tr>
 }
 }
 </tbody>
 </table>
 </section> *@

 <section class="db-section"> @* Formulário manual de escalonamento *@
 <h3>Escalonamento Manual</h3>
 <form method="post" asp-action="Escalonamento" asp-controller="Site">
 <label for="protocolo_escalonar">Protocolo do Chamado:</label><br />
 <input type="text" id="protocolo_escalonar" name="protocolo" placeholder="Ex: CHAM-2025-001" required class="form-control" /><br /><br />

 <label for="motivo_escalonamento">Motivo do Escalonamento:</label><br />
 <textarea id="motivo_escalonamento" name="motivo" rows="4" cols="80" placeholder="Justifique o motivo do escalonamento..." required class="form-control"></textarea><br /><br />

 <label for="novo_tecnico">Atribuir para (id ou nome):</label><br />
 <input type="text" id="novo_tecnico" name="novo_tecnico" placeholder="Id ou nome do técnico" class="form-control" /><br /><br />

 <label for="nova_prioridade">Reclassificar Prioridade (opcional):</label><br />
 <select id="nova_prioridade" name="nova_prioridade" class="form-select">
 <option value="">Manter prioridade atual</option>
 <option value="critica">Crítica</option>
 <option value="alta">Alta</option>
 <option value="media">Média</option>
 <option value="baixa">Baixa</option>
 </select><br /><br />

 <button type="submit" class="btn btn-primary">Realizar Escalonamento</button>
 </form>
 </section>
 
 </main>
 </div>
 <div class="db-footer"> @* Rodapé *@
 <footer>
 <p>©2025 SoftForge - Todos os direitos reservados</p>
 </footer>
 </div>
</body>
</html>