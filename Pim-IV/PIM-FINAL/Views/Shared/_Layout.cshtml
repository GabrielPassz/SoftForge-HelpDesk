@* Layout principal: define head comum (meta, estilos), container de conteúdo com @RenderBody, rodapé e scripts globais. *@
<!DOCTYPE html>
<html lang="en" data-env="@Environment.GetEnvironmentVariable("ASPNETCORE_ENVIRONMENT")"> 
<head>
 <meta charset="utf-8" /> @* Codificação UTF-8 *@
 <meta name="viewport" content="width=device-width, initial-scale=1.0" /> @* Responsividade *@
 <title>@ViewData["Title"] - PIM</title> @* Título dinâmico da página *@
 <link rel="manifest" href="/manifest.webmanifest" /> @* Manifest PWA *@
 <meta name="theme-color" content="#0d6efd" /> @* Cor do tema para navegadores *@
 <link rel="apple-touch-icon" href="/icons/icon-192.png" /> @* Ícone para iOS *@
 <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" /> @* CSS do Bootstrap *@
 <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" /> @* CSS padrão do site com bust de cache *@
 <link rel="stylesheet" href="~/PIM.styles.css" asp-append-version="true" /> @* Estilos gerados (Razor) *@
 <link rel="stylesheet" href="~/css/dbtestes.css" asp-append-version="true" /> @* Estilos customizados do dashboard *@
</head>
<body data-auth="@User?.Identity?.IsAuthenticated">
 @* O cabeçalho real (_HeaderNav) é incluído diretamente nas views *@
 <div class="container"> @* Container principal para conteúdo *@
 <main role="main" class="pb-3"> @* Área do corpo renderizada pelas views *@
 @RenderBody()
 </main>
 </div>
 <footer class="border-top footer text-muted"> @* Rodapé simples com link de privacy *@
 <div class="container">
 &copy;2025 - PIM - <a asp-area="" asp-controller="Home" asp-action="Privacy">Privacy</a>
 </div>
 </footer>
 <script src="~/lib/jquery/dist/jquery.min.js"></script> @* jQuery *@
 <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script> @* JS do Bootstrap *@
 <script src="~/js/site.js" asp-append-version="true"></script> @* Script global do site (inclui utilitários) *@
 <script>
 const env = '@Environment.GetEnvironmentVariable("ASPNETCORE_ENVIRONMENT")'; // Descobre ambiente atual
 if (env === 'Production' && 'serviceWorker' in navigator) {
 // Em produção: registra Service Worker para PWA/cache controlado
 window.addEventListener('load', () => {
 navigator.serviceWorker.getRegistrations().then(regs => {
 regs.forEach(r => r.update()); // Atualiza SWs existentes
 });
 navigator.serviceWorker.register('/sw.js?rev=@DateTime.UtcNow.Ticks').catch(e => console.warn('SW fail', e)); // Registra SW
 });
 } else {
 // Em desenvolvimento: remove SW antigo para evitar cache
 if ('serviceWorker' in navigator) {
 navigator.serviceWorker.getRegistrations().then(regs => regs.forEach(r => r.unregister()));
 caches && caches.keys && caches.keys().then(keys => keys.forEach(k => caches.delete(k)));
 }
 }
 const isIos = /iphone|ipad|ipod/i.test(navigator.userAgent); // Detecta iOS
 const isStandalone = window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone; // Detecta PWA standalone
 if(isIos && !isStandalone){
 console.log('Para instalar, abra o menu Compartilhar e escolha "Adicionar à Tela de Início"'); // Dica de instalação em iOS
 }
 </script>
 @await RenderSectionAsync("Scripts", required: false) @* Ponto de injeção opcional de scripts por view *@
</body>
</html>
