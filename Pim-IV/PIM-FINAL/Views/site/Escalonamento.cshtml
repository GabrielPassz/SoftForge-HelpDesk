@model List<PIM_FINAL.Models.ChamadoSummary>
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers

@* Página Escalonamento: monitoramento de risco/SLA e formulário para escalonar manualmente chamados. *@
<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Escalonamento - SoftForge HelpDesk</title>
<link rel="stylesheet" href="/css/dbtestes.css" />
</head>
<body>
<div class="db-page container-fluid">
 @await Html.PartialAsync("_HeaderNav")

 <main class="db-content">
 <div class="db-header"> @* Cabeçalho geral *@
 <header><h1>Escalonamento</h1><p>Área de monitoramento e escalonamento de chamados</p></header>
 </div>

 <section class="db-section"> @* Identificação *@
 <h2>Escalonamento de Chamados</h2>
 <p><strong>Coordenador:</strong> @User?.Identity?.Name</p>
 </section>

 <section class="db-section"> @* Filtros *@
 <h3>Pesquisa</h3>
 <form method="get" asp-action="Escalonamento" asp-controller="Site">
 <label for="busca_protocolo">Buscar por protocolo:</label>
 <input type="text" id="busca_protocolo" name="protocolo" value="@Context.Request.Query["protocolo"]" placeholder="Ex: CHAM-2025-001" />
 <button type="submit" class="btn btn-primary">Filtrar</button>
 </form>
 
 @* Resumo dos resultados da busca *@
 @{
 var termo = Context.Request.Query["protocolo"].ToString();
 var temBusca = !string.IsNullOrWhiteSpace(termo);
 }
 <div class="db-section">
 <h4>Resultados</h4>
 @if (Model != null && Model.Any())
 {
 <ul class="list-group">
 @foreach (var c in Model)
 {
 <li class="list-group-item">
 <strong>[@c.Protocolo]</strong> @c.Titulo<br />
 <small>Prioridade: @c.Prioridade | Técnico: @c.Tecnico | SLA: @c.SlaConsumedPercent% | Restante: @(c.TimeRemaining.HasValue ? (c.TimeRemaining.Value.TotalHours >=1 ? $"{(int)c.TimeRemaining.Value.TotalHours}h{c.TimeRemaining.Value.Minutes}m" : $"{c.TimeRemaining.Value.Minutes}m") : "-")</small>
 <div style="margin-top:6px">
 <a class="btn btn-sm btn-secondary" asp-controller="Site" asp-action="DetalhesEscalonamento" asp-route-id="@c.ChamadoId">Detalhes</a>
 <a class="btn btn-sm btn-outline-primary" asp-controller="Site" asp-action="DetalhesChamado" asp-route-id="@c.ChamadoId">Abrir</a>
 </div>
 </li>
 }
 </ul>
 }
 else
 {
 <p>@(temBusca ? "Nenhum chamado encontrado para o protocolo informado." : "Informe um protocolo e clique em Filtrar.")</p>
 }
 </div>
 </section>

 <section class="db-section"> @* Escalonamento manual *@
 <h3>Escalonamento Manual</h3>
 <form method="post" asp-action="Escalonamento" asp-controller="Site">
 <label for="protocolo_escalonar">Protocolo do Chamado:</label><br />
 <input type="text" id="protocolo_escalonar" name="protocolo" placeholder="Ex: CHAM-2025-001" required class="form-control" /><br /><br />
 <label for="motivo_escalonamento">Motivo do Escalonamento:</label><br />
 <textarea id="motivo_escalonamento" name="motivo" rows="4" cols="80" placeholder="Justifique o motivo do escalonamento..." required class="form-control"></textarea><br /><br />
 <label for="novo_tecnico">Atribuir para (id ou nome):</label><br />
 <input type="text" id="novo_tecnico" name="novo_tecnico" placeholder="Id ou nome do técnico" class="form-control" /><br /><br />
 <label for="nova_prioridade">Reclassificar Prioridade (opcional):</label><br />
 <select id="nova_prioridade" name="nova_prioridade" class="form-select">
 <option value="">Manter prioridade atual</option>
 <option value="critica">Crítica</option>
 <option value="alta">Alta</option>
 <option value="media">Média</option>
 <option value="baixa">Baixa</option>
 </select><br /><br />
 <button type="submit" class="btn btn-primary">Realizar Escalonamento</button>
 </form>
 </section>
 </main>
 </div>
 <div class="db-footer">
 <footer><p>©2025 SoftForge - Todos os direitos reservados</p></footer>
 </div>
</body>
</html>